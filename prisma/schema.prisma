generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 案件ステータス
enum ProjectStatus {
  CONFIRMED   // 実績（確定・受注済）
  PROSPECTIVE // 見込み（予定・未受注）
}

// 認証用ユーザー
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  name          String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// メンバー（工数管理対象）
model Member {
  id            String    @id @default(cuid())
  name          String
  role          String    // PG, SE, PM など
  hourlyRate    Int       // 工賃（時給または月額）
  workCapacity  Float     @default(1.0)  // 月間稼働可能人月
  memo          String?   // 技術スキル等
  sortOrder     Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  assignments   Assignment[]
}

// 案件
model Project {
  id            String    @id @default(cuid())
  name          String
  type          String    @default("開発") // 開発, 保守, 管理, その他
  status        ProjectStatus @default(CONFIRMED) // 実績, 見込み
  description   String?   // 技術スタック等
  budget        Int?      // 予算
  startDate     DateTime?
  endDate       DateTime?
  sortOrder     Int       @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  assignments   Assignment[]
  monthlyBudgets MonthlyBudget[]
}

// 案件別の月次予算（保守などの月計算用、交渉による変更に対応）
model MonthlyBudget {
  id            String    @id @default(cuid())
  projectId     String
  year          Int
  month         Int
  amount        Int
  createdAt     DateTime  @default(now())
  project       Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, year, month])
}

// 工数アサイン
model Assignment {
  id            String    @id @default(cuid())
  memberId      String
  projectId     String
  year          Int
  month         Int       // 1〜12
  manMonth      Float     // 0.5, 0.6 など
  createdAt     DateTime  @default(now())
  member        Member    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  project       Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([memberId, projectId, year, month])
}
